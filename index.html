<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>multiray.js test</title>
</head>

<body>

<script src="js/multiray.js"></script>

<!-- ------------------------------ -->
<h2><a href="https://github.com/rkibria/multiray.js">multiray.js</a> - JavaScript ray-tracing</h2>

<!-- ------------------------------ -->
<hr>
<h3>Test 1</h3>

<p id="renderinfo1"></p>
<canvas id="rendercanvas1" width="640" height="480">Your browser does not support the HTML5 canvas1 tag.</canvas>
<p id="rendertime1">rendering...</p>

<p id="renderinfo2"></p>
<canvas id="rendercanvas2" width="640" height="480">Your browser does not support the HTML5 canvas1 tag.</canvas>
<p id="rendertime2">rendering...</p>

<p id="renderinfo3"></p>
<canvas id="rendercanvas3" width="640" height="480">Your browser does not support the HTML5 canvas1 tag.</canvas>
<p id="rendertime3">rendering...</p>

<!-- ------------------------------ -->
<hr>
<h3>References</h3>
<ul>
	<li><a href="https://github.com/rkibria/multiray.js">GitHub project page</a></li>
	<li><a href="https://rkibria.github.io/multiray.js">GitHub Pages project main page</a></li>
	<li>Peter Shirley: Ray Tracing in One Weekend</li>
	<ul>
		<li><a href="https://www.amazon.com/gp/product/B01B5AODD8/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01B5AODD8&linkCode=as2&tag=inonwe09-20&linkId=OPNJXXJY2IBCMEGE">Ray Tracing in One Weekend Kindle Edition</a></li>
		<li><a href="http://in1weekend.blogspot.de/2016/01/ray-tracing-in-one-weekend.html">Ray Tracing in One Weekend blog</a></li>
	</ul>
	<li><a href="https://www.scratchapixel.com/index.php">scratchapixel.com</a></li>
	<ul>
		<li><a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-ray-tracing">Introduction to Ray Tracing: a Simple Method for Creating 3D Images</a></li>
		<li><a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-overview">An Overview of the Ray-Tracing Rendering Technique</a></li>
		<li><a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-generating-camera-rays">Ray-Tracing: Generating Camera Rays</a></li>
	</ul>
</ul>

<!-- ------------------------------ -->

<script>
const renderer = new MULTIRAY.Renderer();

const scene1 = new MULTIRAY.Scene();

const cvsize = MULTIRAY.Helpers.getCanvasSize(document.getElementById("rendercanvas1"));
const aspect = cvsize.x / cvsize.y;

const camera = new MULTIRAY.Camera( // lookfrom, lookat, vup, vfov, aspect
	new MULTIRAY.Vector3(0, 0, 2),
	new MULTIRAY.Vector3(0, 0, -1),
	new MULTIRAY.Vector3(0, 1, 0),
	45,
	aspect
	);
scene1.setCamera(camera);

scene1.addObject(new MULTIRAY.Sphere("sph_mid", new MULTIRAY.Vector3(0, 0, -1), 0.5, new MULTIRAY.LambertianMaterial(new MULTIRAY.Vector3(0.8, 0, 0))));
scene1.addObject(new MULTIRAY.Sphere("sph_ground", new MULTIRAY.Vector3(0, -100.5, -1), 100, new MULTIRAY.LambertianMaterial(new MULTIRAY.Vector3(0.8, 0.8, 0.8))));
scene1.addObject(new MULTIRAY.Sphere("sph_right", new MULTIRAY.Vector3(1, 0, -1), 0.5, new MULTIRAY.DielectricMaterial(1.5)));
scene1.addObject(new MULTIRAY.Sphere("sph_left", new MULTIRAY.Vector3(-1, 0, -1), 0.5, new MULTIRAY.MetalMaterial(new MULTIRAY.Vector3(0.8, 0.8, 0.8), 0.05)));
scene1.addObject(new MULTIRAY.Sphere("sph_mid_far", new MULTIRAY.Vector3(0, 0, -2), 0.5, new MULTIRAY.LambertianMaterial(new MULTIRAY.Vector3(0.0, 0.8, 0))));
scene1.addObject(new MULTIRAY.Sphere("sph_left_far", new MULTIRAY.Vector3(-1, -0.25, -2), 0.25, new MULTIRAY.LambertianMaterial(new MULTIRAY.Vector3(0.0, 0.0, 0.8))));
scene1.addObject(new MULTIRAY.Sphere("sph_left_near", new MULTIRAY.Vector3(-1, -0.25, 0.25), 0.25, new MULTIRAY.MetalMaterial(new MULTIRAY.Vector3(0.8, 0.8, 0.0), 0.5)));
scene1.addObject(new MULTIRAY.Sphere("sph_far_left_near", new MULTIRAY.Vector3(-1.5, -0.25, -0.6), -0.25, new MULTIRAY.DielectricMaterial(1.1)));
scene1.addObject(new MULTIRAY.Sphere("sph_right_far", new MULTIRAY.Vector3(2, -0.25, -3), 0.25, new MULTIRAY.LambertianMaterial(new MULTIRAY.Vector3(0.8, 0, 0.8))));

document.getElementById("renderinfo1").innerHTML = scene1.toString();

let t0 = 0, t1 = 0, depth = 50;
renderer.nSamplesPerPixel = 50;

function runRender(scene, canvas, depth) {
	t0 = performance.now();
	renderer.renderToCanvas(scene, depth, canvas);
	t1 = performance.now();
	let cvsize = MULTIRAY.Helpers.getCanvasSize(canvas);
	return "Render time: " + Math.floor(t1 - t0) + " ms,"
		+ " max depth: " + renderer.maxDepth 
		+ ", samples/pixel: " + renderer.nSamplesPerPixel 
		+ ", canvas size: " + cvsize.x + "x" + cvsize.y;
}

(function drawFrame () {
	document.getElementById("rendertime1").innerHTML = runRender(scene1, document.getElementById("rendercanvas1"), depth);

	camera.setView(
		new MULTIRAY.Vector3(-4, 0, -1),
		new MULTIRAY.Vector3(0, 0, -1),
		new MULTIRAY.Vector3(0, 1, 0),
		45,
		aspect
		);
	document.getElementById("renderinfo2").innerHTML = "<ul><li>" + camera.toString() + "</li></ul>";
	document.getElementById("rendertime2").innerHTML = runRender(scene1, document.getElementById("rendercanvas2"), depth);

	camera.setView(
		new MULTIRAY.Vector3(0, 4, -1),
		new MULTIRAY.Vector3(0, 0, -1),
		new MULTIRAY.Vector3(0, 0, -1),
		45,
		aspect
		);
	document.getElementById("renderinfo3").innerHTML = "<ul><li>" + camera.toString() + "</li></ul>";
	document.getElementById("rendertime3").innerHTML = runRender(scene1, document.getElementById("rendercanvas3"), depth);
}());

</script>

</body>
</html>
